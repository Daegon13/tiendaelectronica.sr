---
import BaseLayout from "../../layouts/BaseLayout.astro";
const base = import.meta.env.BASE_URL;
const href = (p: string) => `${base}${p.replace(/^\//, "")}`;
---
<BaseLayout title="Confirmación | Tienda Electrónica SR">
  <h1 class="text-xl font-semibold">Pedido recibido</h1>
  <div id="box" class="mt-6 rounded-lg border border-slate-200 p-6"></div>

  <div class="mt-6 flex gap-3">
    <a class="rounded-md bg-slate-900 px-4 py-2 text-sm font-medium text-white hover:bg-slate-800" href={href("/catalogo")}>Seguir comprando</a>
    <a class="rounded-md border border-slate-200 px-4 py-2 text-sm font-medium hover:bg-slate-50" href={href("/contacto")}>Contactar</a>
  </div>

  <script type="module">
    import { getLastOrder } from "../../lib/order";
    import { formatMoney } from "../../lib/format";

    const box = document.getElementById("box");
    const order = getLastOrder();

    if (!order) {
      box.innerHTML = `<div class="text-slate-600">No se encontró la orden (demo). Volvé a intentar desde el checkout.</div>`;
    } else {
      const items = order.items
        .map(i => `<li class="flex justify-between gap-3"><span>${i.qty} × ${i.name}</span><span class="font-semibold">${formatMoney(i.unitPrice * i.qty, i.currency)}</span></li>`)
        .join("");

      box.innerHTML = `
        <div class="text-sm text-slate-600">Número de orden</div>
        <div class="mt-1 text-lg font-semibold">${order.orderNumber}</div>

        <div class="mt-4 rounded-md bg-slate-50 p-4">
          <div class="font-semibold">Resumen</div>
          <ul class="mt-2 space-y-2 text-sm">${items}</ul>
          <div class="mt-3 border-t border-slate-200 pt-3 text-sm">
            <div class="flex justify-between"><span class="text-slate-600">Subtotal</span><span class="font-semibold">${formatMoney(order.totals.subtotal, order.totals.currency)}</span></div>
            <div class="mt-1 flex justify-between"><span class="text-slate-600">Envío</span><span class="font-semibold">${formatMoney(order.totals.shipping, order.totals.currency)}</span></div>
            <div class="mt-2 flex justify-between text-base"><span class="font-semibold">Total</span><span class="font-semibold">${formatMoney(order.totals.total, order.totals.currency)}</span></div>
          </div>
        </div>

        <div class="mt-4 text-sm text-slate-700">
          Entrega: <span class="font-semibold">${order.fulfillment.method === "pickup" ? "Retiro en local" : "Envío"}</span>
        </div>
        <div class="mt-2 text-sm text-slate-600">
          Próximos pasos: nos comunicamos para coordinar entrega o retiro (demo).
        </div>
      `;
    }
  </script>
</BaseLayout>
